<!doctype html>

<head>
  <style>
    body {
      background-color: rgb(23, 238, 173);
      margin: 3%;
    }

    canvas {
      display: block;
      margin: auto;
    }

    .button {
            padding: 1.5px;
            border-radius: 25px;
            background-color: red;
            border: 2px solid black;
            color: black;
            text-align: center;
            width: 15%;
            font-size: 15px;
            font-weight: bold;
            font-family: 'century gothic';
            display: center;
            justify-content: center;
    
    }

    button:hover {
        background-color: red;
    }

  </style>

  <title>Doodle who jumps</title>
  <script src="jumper.js"></script>
  <script src="platform.js"></script>
</head>

<body>
  <canvas id="gameCanvas" width="800" height="600"></canvas>
  <button onClick="location.reload();">Restart</button>   <!-- refresh the page --> 

</body>
<script>
  var canvas, canvasContext;

  window.onload = function () {
    canvas = document.getElementById('gameCanvas');
    canvasContext = canvas.getContext('2d');

    document.addEventListener('keydown', keyPressed);
    document.addEventListener('keyup', keyReleased);

    setInterval(mainloop, 1000 / 50);
  }

  var userName = ''; //username text prompt, player enters their name here
        var userPass = false; //case for false entries in name 
        while (userPass == false) {
            userName = prompt("What is your name? Max length 10", "barry");
            if (userName != null && userName != '') {
                if (userName.length <= 10) { //text limit at 10, so end screen isn't too big and the name fits in the prompt bar

                    userPass = true;
                }
            }

        }
        // difficulty prompt
        var difficulty = '';
        var difficultyPass = false;
        while (difficultyPass == false) {
            difficulty = prompt("Select the difficulty: easy, medium, hard", "easy");

            difficulty = difficulty.toLowerCase()

            if (difficulty == 'easy' || difficulty == 'medium' || difficulty == 'hard') {
                difficultyPass = true; // if statement is compatable with criteria then run as true and game will run
            }
        } 

        platformCount = 0     

        if(difficulty == 'easy'){
          platformCount = 10;
        }
        if(difficulty == 'medium'){
          platformCount = 8;
        }
        if(difficulty == 'hard'){
          platformCount = 5;
        }

  // player vars/const
  var pXpos = 0;
  var pYpos = 0;
  var pXspeed = 5;
  var pYspeed = 5;
  const P_SIZE = 25;
  var yVel = 0; //gravity
  var thrust = -5; // gravity speed



  // key codes
  const UP_KEY = 87;
  const LEFT_KEY = 65;
  const RIGHT_KEY = 68;
  const SPACE_KEY = 32;
  var upPressed = false;
  var downPressed = false;
  var leftPressed = false;
  var rightPressed = false;
  var spacePressed = false;

  var player = new Player(pXpos, pYpos, P_SIZE, P_SIZE, 'red', pXspeed, pYspeed, yVel, thrust);

  var setUp = true;

        var score = 0;

  function mainloop() {
    if (setUp) {
      pXpos = canvas.width/2;
      for (var i = 0; i < platformCount; i++) {
        createPlatform();
      }
      setUp = false;
    }
    score++;
    colorRect(0, 0, canvas.width, canvas.height, 'black'); // bg
    player.drawRect(); // player
    player.playerMove();
    colorText(score, 50, 50, "20px arial", "white"); //score ticker

    
      if (platforms.length > 0) {
          platforms.forEach(function (platform, i, array) {
            platform.drawRect();
            platform.platformMove();
            // if(platform.playerDeath() == true){
            //   console.log('dead');
            // }
          }); // end foreach
        } // end if 
  } // end of func

  var platforms = []; // platform array

   function createPlatform() {
    // platform vars
    var pWidth = 100;
    var pHeight = 10;
   
    var pYpos = pWidth;
    var pXpos = Math.floor(Math.random() * (canvas.width - pWidth));
    // var pXspeed = Math.floor(Math.random() * (12 - 3) + 3);
    var pYspeed = Math.floor(Math.random() * (12 - 3) + 3);

    // create platform class with vars
    var platform = new Platform(pXpos, pYpos, pWidth, pHeight, 'purple', pXspeed, pYspeed);
    // add platform to platforms array
    platforms.push(platform); 

  } // end func



  function keyPressed(evt) {
    if (evt.keyCode == LEFT_KEY) {
      leftPressed = true;
    }
    if (evt.keyCode == RIGHT_KEY) {
      rightPressed = true;
    }
    // if (evt.keyCode == SPACE_KEY) {
    //   spacePressed = true;
    // }
  } // end of func

  function keyReleased(evt) {
    if (evt.keyCode == LEFT_KEY) {
      leftPressed = false;
    }
    if (evt.keyCode == RIGHT_KEY) {
      rightPressed = false;
    }
    // if (evt.keyCode == SPACE_KEY) {
    //   spacePressed = false;
    // }
  } // end of func

  function colorRect(x, y, w, h, c) {
    canvasContext.fillStyle = c;
    canvasContext.fillRect(x, y, w, h);
  } //end of func

  function colorText(msg, x, y, f, c){ // draws messages (score, end game etc.)
    canvasContext.filstyle = c;
    canvasContext.font = f;
    canvasContext.fillText(msg, x, y);


  } //end func
</script>